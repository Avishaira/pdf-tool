<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Master - Free Merge & Split Tool</title>
    <meta name="description" content="Merge and Split PDF files for free. Secure, client-side, no uploads.">

    <!-- 1. STYLING (Tailwind) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 2. REACT FRAMEWORK -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 3. BABEL (Translates code for browser) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 4. PDF ENGINES (The Tools) -->
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://unpkg.com/jszip@3.10.1/dist/jszip.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #F8FAFC; }
        .animate-spin { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- THE APP LOGIC -->
    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ICONS (Hardcoded to prevent loading errors) ---
        const Icon = ({ path, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d={path} />
            </svg>
        );
        const Icons = {
            Layers: (p) => <Icon {...p} path="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />,
            Scissors: (p) => <svg {...p} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="6" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><line x1="20" y1="4" x2="8.12" y2="15.88"/><line x1="14.47" y1="14.48" x2="20" y2="20"/><line x1="8.12" y1="8.12" x2="12" y2="12"/></svg>,
            Upload: (p) => <Icon {...p} path="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12" />,
            Download: (p) => <Icon {...p} path="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3" />,
            Plus: (p) => <Icon {...p} path="M12 5v14M5 12h14" />,
            Trash: (p) => <Icon {...p} path="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />,
            File: (p) => <Icon {...p} path="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" />,
            ArrowUp: (p) => <Icon {...p} path="M12 19V5M5 12l7-7 7 7" />,
            ArrowDown: (p) => <Icon {...p} path="M12 5v14M19 12l-7 7-7-7" />,
            X: (p) => <Icon {...p} path="M18 6L6 18M6 6l12 12" />,
            Loader: (p) => <Icon {...p} className={`${p.className} animate-spin`} path="M21 12a9 9 0 1 1-6.219-8.56" />
        };

        // --- MAIN APP COMPONENT ---
        const App = () => {
            const [activeTab, setActiveTab] = useState('merge');
            const [isReady, setIsReady] = useState(false);

            // Engine Check
            useEffect(() => {
                const check = () => {
                    if (window.PDFLib && window.JSZip) setIsReady(true);
                    else requestAnimationFrame(check);
                };
                check();
            }, []);

            return (
                <div className="min-h-screen flex flex-col items-center py-10 px-4 max-w-6xl mx-auto">
                    
                    {/* Header */}
                    <div className="text-center mb-10">
                        <div className="inline-block p-4 bg-indigo-600 rounded-2xl shadow-lg shadow-indigo-200 mb-4">
                            <Icons.Layers className="w-8 h-8 text-white" />
                        </div>
                        <h1 className="text-4xl font-extrabold text-slate-900 mb-2">PDF Master Tool</h1>
                        <p className="text-slate-500">Secure, Client-Side PDF Merge & Split</p>
                    </div>

                    {/* Navigation */}
                    <div className="bg-white p-1 rounded-xl shadow-sm border border-slate-200 flex w-full max-w-md mb-8">
                        <button onClick={() => setActiveTab('merge')} className={`flex-1 py-3 rounded-lg text-sm font-bold flex items-center justify-center gap-2 transition-all ${activeTab === 'merge' ? 'bg-indigo-600 text-white shadow' : 'text-slate-500 hover:bg-slate-50'}`}>
                            <Icons.Layers className="w-4 h-4" /> Merge
                        </button>
                        <button onClick={() => setActiveTab('split')} className={`flex-1 py-3 rounded-lg text-sm font-bold flex items-center justify-center gap-2 transition-all ${activeTab === 'split' ? 'bg-indigo-600 text-white shadow' : 'text-slate-500 hover:bg-slate-50'}`}>
                            <Icons.Scissors className="w-4 h-4" /> Split
                        </button>
                    </div>

                    {/* Main Workspace */}
                    <div className="w-full bg-white rounded-3xl shadow-xl shadow-slate-200/50 border border-slate-100 overflow-hidden min-h-[400px]">
                        {activeTab === 'merge' ? 
                            <MergeTool isReady={isReady} /> : 
                            <SplitTool isReady={isReady} />
                        }
                    </div>

                    {/* Footer */}
                    <div className="mt-8 text-center text-xs text-slate-400">
                        Status: {isReady ? <span className="text-green-600 font-bold">Engine Ready</span> : "Loading Libraries..."}
                    </div>
                </div>
            );
        };

        // --- MERGE TOOL ---
        const MergeTool = ({ isReady }) => {
            const [files, setFiles] = useState([]);
            const [processing, setProcessing] = useState(false);

            const handleUpload = async (e) => {
                const newFiles = Array.from(e.target.files);
                if (!newFiles.length) return;
                setProcessing(true);
                
                try {
                    const processed = await Promise.all(newFiles.map(async (file) => {
                        const buff = await file.arrayBuffer();
                        const doc = await PDFLib.PDFDocument.load(buff, { ignoreEncryption: true });
                        return {
                            id: Math.random().toString(36),
                            file, name: file.name,
                            pageCount: doc.getPageCount(),
                            range: `1-${doc.getPageCount()}`,
                            buff
                        };
                    }));
                    setFiles(prev => [...prev, ...processed]);
                } catch (err) { alert("Error reading files. They may be corrupted."); }
                setProcessing(false);
            };

            const doMerge = async () => {
                if (!files.length) return;
                setProcessing(true);
                try {
                    const merged = await PDFLib.PDFDocument.create();
                    for (const f of files) {
                        const src = await PDFLib.PDFDocument.load(f.buff, { ignoreEncryption: true });
                        const indices = parseRange(f.range, f.pageCount);
                        const pages = await merged.copyPages(src, indices);
                        pages.forEach(p => merged.addPage(p));
                    }
                    saveBlob(await merged.save(), "merged.pdf", "application/pdf");
                } catch (e) { alert("Merge failed"); }
                setProcessing(false);
            };

            const move = (idx, dir) => {
                const arr = [...files];
                if (dir === -1 && idx > 0) [arr[idx], arr[idx-1]] = [arr[idx-1], arr[idx]];
                if (dir === 1 && idx < arr.length-1) [arr[idx], arr[idx+1]] = [arr[idx+1], arr[idx]];
                setFiles(arr);
            };

            return (
                <div className="p-8">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-xl font-bold">Merge Files</h2>
                        <div className="flex gap-2">
                             <label className={`cursor-pointer px-4 py-2 bg-slate-100 hover:bg-slate-200 rounded-lg font-bold text-sm flex items-center gap-2 ${!isReady && 'opacity-50'}`}>
                                <Icons.Plus className="w-4 h-4" /> Add Files
                                <input type="file" multiple accept=".pdf" className="hidden" onChange={handleUpload} disabled={!isReady} />
                            </label>
                            {files.length > 0 && (
                                <button onClick={doMerge} disabled={processing} className="px-6 py-2 bg-indigo-600 text-white rounded-lg font-bold text-sm flex items-center gap-2">
                                    {processing ? <Icons.Loader className="w-4 h-4" /> : <Icons.Layers className="w-4 h-4" />} Merge
                                </button>
                            )}
                        </div>
                    </div>

                    {files.length === 0 ? (
                        <div className="text-center py-20 bg-slate-50 rounded-2xl border border-dashed border-slate-300">
                            <Icons.Upload className="w-12 h-12 text-slate-300 mx-auto mb-4" />
                            <p className="text-slate-500">Click "Add Files" to start</p>
                        </div>
                    ) : (
                        <div className="space-y-3">
                            {files.map((f, i) => (
                                <div key={f.id} className="flex items-center gap-4 bg-slate-50 p-4 rounded-xl border border-slate-200">
                                    <div className="flex flex-col text-slate-400">
                                        <button onClick={() => move(i, -1)}><Icons.ArrowUp className="w-4 h-4 hover:text-indigo-600" /></button>
                                        <button onClick={() => move(i, 1)}><Icons.ArrowDown className="w-4 h-4 hover:text-indigo-600" /></button>
                                    </div>
                                    <div className="flex-1 overflow-hidden">
                                        <div className="font-bold truncate">{f.name}</div>
                                        <div className="text-xs text-slate-500">{f.pageCount} Pages</div>
                                    </div>
                                    <input className="w-24 p-2 text-sm border rounded" value={f.range} onChange={e => {
                                        const n = [...files]; n[i].range = e.target.value; setFiles(n);
                                    }} />
                                    <button onClick={() => setFiles(files.filter((_, idx) => idx !== i))} className="text-red-400 hover:text-red-600">
                                        <Icons.Trash className="w-5 h-5" />
                                    </button>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        // --- SPLIT TOOL ---
        const SplitTool = ({ isReady }) => {
            const [file, setFile] = useState(null);
            const [ranges, setRanges] = useState([{id:1, val:''}]);
            const [processing, setProcessing] = useState(false);

            const handleUpload = async (e) => {
                const f = e.target.files[0];
                if (!f) return;
                setProcessing(true);
                const b = await f.arrayBuffer();
                const d = await PDFLib.PDFDocument.load(b, {ignoreEncryption:true});
                setFile({ file: f, name: f.name, count: d.getPageCount(), buff: b });
                setRanges([{id:1, val: `1-${d.getPageCount()}`}]);
                setProcessing(false);
            };

            const doSplit = async (mode) => {
                if (!file) return;
                setProcessing(true);
                try {
                    const src = await PDFLib.PDFDocument.load(file.buff, {ignoreEncryption:true});
                    const zip = new JSZip();
                    
                    if (mode === 'all') {
                        for(let i=0; i<file.count; i++) {
                            const d = await PDFLib.PDFDocument.create();
                            const [p] = await d.copyPages(src, [i]);
                            d.addPage(p);
                            zip.file(`Page_${i+1}.pdf`, await d.save());
                        }
                    } else {
                        for(let r of ranges) {
                            const idxs = parseRange(r.val, file.count);
                            if(idxs.length) {
                                const d = await PDFLib.PDFDocument.create();
                                const pgs = await d.copyPages(src, idxs);
                                pgs.forEach(p => d.addPage(p));
                                zip.file(`Split_${r.id}.pdf`, await d.save());
                            }
                        }
                    }
                    saveBlob(await zip.generateAsync({type:"blob"}), "split_files.zip", "application/zip");
                } catch(e) { alert("Split failed"); }
                setProcessing(false);
            };

            return (
                 <div className="p-8">
                    {!file ? (
                        <label className={`block text-center py-20 bg-slate-50 rounded-2xl border border-dashed border-slate-300 cursor-pointer hover:bg-slate-100 ${!isReady && 'opacity-50'}`}>
                            <Icons.Upload className="w-12 h-12 text-slate-300 mx-auto mb-4" />
                            <p className="font-bold text-slate-700">Upload PDF to Split</p>
                            <input type="file" accept=".pdf" className="hidden" onChange={handleUpload} disabled={!isReady} />
                        </label>
                    ) : (
                        <div className="flex flex-col md:flex-row gap-8">
                            <div className="w-full md:w-1/3 space-y-4">
                                <div className="p-4 bg-slate-100 rounded-xl">
                                    <div className="font-bold truncate">{file.name}</div>
                                    <div className="text-sm text-slate-500">{file.count} Pages</div>
                                    <button onClick={() => setFile(null)} className="text-xs text-red-500 mt-2 font-bold">Change File</button>
                                </div>
                                <button onClick={() => doSplit('all')} disabled={processing} className="w-full py-3 bg-white border-2 border-slate-200 hover:border-indigo-500 rounded-xl font-bold text-slate-700 flex items-center justify-center gap-2">
                                    <Icons.Layers className="w-4 h-4" /> Extract All Pages
                                </button>
                                <button onClick={() => doSplit('custom')} disabled={processing} className="w-full py-3 bg-indigo-600 text-white rounded-xl font-bold flex items-center justify-center gap-2">
                                    {processing ? <Icons.Loader className="w-4 h-4" /> : <Icons.Download className="w-4 h-4" />} Download Ranges
                                </button>
                            </div>
                            <div className="flex-1 bg-slate-50 rounded-xl p-4">
                                <div className="flex justify-between mb-4">
                                    <h3 className="font-bold">Custom Ranges</h3>
                                    <button onClick={() => setRanges([...ranges, {id: Date.now(), val: ''}])} className="text-indigo-600 font-bold text-sm">+ Add</button>
                                </div>
                                <div className="space-y-2 max-h-60 overflow-y-auto">
                                    {ranges.map((r, i) => (
                                        <div key={r.id} className="flex gap-2">
                                            <input className="flex-1 p-2 border rounded" placeholder="e.g. 1-5" value={r.val} onChange={e => {
                                                const n = [...ranges]; n[i].val = e.target.value; setRanges(n);
                                            }} />
                                            <button onClick={() => setRanges(ranges.filter(x => x.id !== r.id))}><Icons.X className="w-4 h-4 text-slate-400" /></button>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}
                 </div>
            )
        };

        // --- HELPERS ---
        const parseRange = (str, max) => {
            const s = new Set();
            str.split(',').forEach(x => {
                const clean = x.trim();
                if(clean.includes('-')) {
                    let [a, b] = clean.split('-').map(n => parseInt(n));
                    if(isNaN(a)) a=1; if(isNaN(b)) b=max;
                    for(let i=Math.max(1,a); i<=Math.min(max,b); i++) s.add(i-1);
                } else {
                    const n = parseInt(clean);
                    if(!isNaN(n) && n>=1 && n<=max) s.add(n-1);
                }
            });
            return Array.from(s).sort((a,b)=>a-b);
        };

        const saveBlob = (data, name, type) => {
            const link = document.createElement('a');
            link.href = URL.createObjectURL(new Blob([data], {type}));
            link.download = name;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


